name: android
version: 0.0.15
inherits: pjvds/java@0.1.3
type: main
platform: ubuntu@12.04
description: A box created for Android development
keywords:
  - android
  - gradle
box-detect:
  priority : 200
  version:
  detect:
    - files:
      - build.gradle
default-build:
  android:
    priority : 50
    detect:
      - default: true
    text-to-append: |
      # Build definition
      build:
        # The steps that will be executed on build
        steps:
          - script:
              name: show base information
              code: |
                gradle -v
                echo $ANDROID_HOME
                echo $ANDROID_SDK_VERSION
                echo $ANDROID_BUILD_TOOLS
                echo $ANDROID_UPDATE_FILTER
          # A step that executes `gradle build` command
          - script:
              name: run gradle
              code: |
                gradle --full-stacktrace -q --project-cache-dir=$WERCKER_CACHE_DIR build
script: |
  sdk_version="22.2"

  profile="/etc/environment"

  # Start with a clean profile
  cd $HOME

  # prepare packages
  source $WERCKER_SOURCE_DIR/prepare-packages.sh

  # remove old ones
  source $WERCKER_SOURCE_DIR/purge-packages.sh

  # list installed packages
  sudo dpkg --get-selections

  ## SDK ##
  source $WERCKER_SOURCE_DIR/install-sdk.sh
  source $WERCKER_SOURCE_DIR/update-sdk.sh

  # install graddle
  source $WERCKER_SOURCE_DIR/install-gradle.sh

  cat $profile


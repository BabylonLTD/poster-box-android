name: android
version: 0.0.16-alpha
inherits: pjvds/java@0.1.4
type: main
platform: ubuntu@12.04
description: A box created for Android development
keywords:
  - android
  - gradle
  - maven
  - ant
  - oracle java 7t
  - ivy
box-detect:
  priority : 200
  version:
  detect:
    - files:
      - build.gradle

default-build:
  android:
    priority : 50
    detect:
      - default: true
    text-to-append: |
      # Build definition
      build:
        # The steps that will be executed on build
        steps:
          - script:
              name: show base information
              code: |
                gradle -v
                echo $ANDROID_HOME
                echo $ANDROID_SDK_VERSION
                echo $ANDROID_BUILD_TOOLS
                echo $ANDROID_UPDATE_FILTER
          # A step that executes `gradle build` command
          - script:
              name: run gradle
              code: |
                gradle --full-stacktrace -q --project-cache-dir=$WERCKER_CACHE_DIR build
script: |
  sdk_version="22.2"

  profile="/etc/environment"

  # Start with a clean profile
  cd $HOME

  # prepare packages
  source $WERCKER_SOURCE_DIR/prepare-packages.sh

  # remove old ones
  source $WERCKER_SOURCE_DIR/purge-packages.sh

  # list installed packages
  sudo dpkg --get-selections

  ## SDK ##
  source $WERCKER_SOURCE_DIR/install-sdk.sh
  source $WERCKER_SOURCE_DIR/update-sdk.sh

  export $GRADLE_VERSION=1.7
  # install graddle
  source $WERCKER_SOURCE_DIR/install-gradle.sh

  export $GRADLE_VERSION=1.8
  # install graddle
  source $WERCKER_SOURCE_DIR/install-gradle.sh

  cat $profile
  eport GRADLE_HOME=$HOME/gradle-$GRADLE_VERSION
  export PATH=$PATH:$GRADLE_HOME/bin

  echo "export GRADLE_HOME=\"${HOME}/gradle-${GRADLE_VERSION}\"" | sudo tee -a $profile
  ADLE_VERSION-bin.zip
  mv gradle-$GRADLE_VERSION $HOME

  export GRADLE_HOME=$HOME/gradle-$GRADLE_VERSION
  export PATH=$PATH:$GRADLE_HOME/bin

  echo "export GRADLE_HOME=\"${HOME}/gradle-${GRADLE_VERSION}\"" | sudo tee -a $profile
  echo "export PATH=\"${PATH}:${GRADLE_HOME}/bin\"" | sudo tee -a $profile

